<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy Policy - MyPetCare</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        header {
            background: #1C8275;
            color: white;
            padding: 40px 20px;
            text-align: center;
            margin: -20px -20px 40px -20px;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        h2 {
            color: #1C8275;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        h3 {
            color: #145B52;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        p, li {
            margin-bottom: 15px;
            color: #555;
        }
        ul, ol {
            margin-left: 30px;
            margin-bottom: 20px;
        }
        .highlight {
            background: #E8F5F3;
            padding: 15px;
            border-left: 4px solid #1C8275;
            margin: 20px 0;
        }
        .contact {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            color: #888;
        }
        a {
            color: #1C8275;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .last-updated {
            color: #888;
            font-style: italic;
            margin-top: 10px;
        }
    </style>

  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Theme color -->
  <meta name="theme-color" content="#1C8275">
  <meta name="msapplication-TileColor" content="#1C8275">
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-128.png">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16.png">
  
  <!-- iOS meta tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PetCare">
  
  <!-- Windows meta tags -->
  <meta name="msapplication-TileImage" content="/icons/icon-144.png">

</head>
<body>
    <div class="container">
        <header>
            <h1>üêæ Privacy Policy</h1>
            <p>MyPetCare - Servizi per Animali Domestici</p>
            <p class="last-updated">Ultimo aggiornamento: 12 Novembre 2025</p>
        </header>

        <div class="highlight">
            <strong>üìå In Breve:</strong> Rispettiamo la tua privacy. Raccogliamo solo i dati essenziali per fornirti il servizio, li proteggiamo con misure di sicurezza avanzate e non li vendiamo mai a terzi.
        </div>

        <h2>1. Titolare del Trattamento</h2>
        <p><strong>MyPetCare</strong><br>
        Email: <a href="mailto:support@mypetcareapp.org">support@mypetcareapp.org</a><br>
        Sito web: <a href="https://mypetcareapp.org">https://mypetcareapp.org</a></p>

        <h2>2. Dati Raccolti</h2>
        <p>Raccogliamo le seguenti categorie di dati personali:</p>

        <h3>2.1 Dati di Registrazione</h3>
        <ul>
            <li><strong>Email</strong>: Per autenticazione e comunicazioni</li>
            <li><strong>Nome e Cognome</strong>: Per identificazione utente</li>
            <li><strong>Password</strong>: Crittografata, mai memorizzata in chiaro</li>
            <li><strong>Numero di telefono</strong>: Per conferme prenotazioni (opzionale)</li>
        </ul>

        <h3>2.2 Dati di Utilizzo</h3>
        <ul>
            <li><strong>Prenotazioni</strong>: Data, ora, servizio richiesto, professionista selezionato</li>
            <li><strong>Posizione geografica</strong>: Per trovare professionisti vicini (con tuo consenso)</li>
            <li><strong>Cronologia prenotazioni</strong>: Per gestione ordini e storico</li>
            <li><strong>Recensioni e valutazioni</strong>: Feedback pubblici sui servizi</li>
        </ul>

        <h3>2.3 Dati di Pagamento</h3>
        <div class="highlight">
            <strong>üîí Importante:</strong> I dati di pagamento (carta di credito, IBAN) sono gestiti ESCLUSIVAMENTE da <strong>Stripe</strong> e <strong>PayPal</strong>. NON memorizziamo mai dati di carte di credito nei nostri server.
        </div>
        <ul>
            <li><strong>Token di pagamento</strong>: Identificativo sicuro fornito da Stripe/PayPal</li>
            <li><strong>Storico transazioni</strong>: Importo, data, stato (senza dati sensibili carta)</li>
        </ul>

        <h3>2.4 Dati Tecnici</h3>
        <ul>
            <li><strong>Indirizzo IP</strong>: Per sicurezza e prevenzione frodi</li>
            <li><strong>Device ID</strong>: Identificativo anonimo del dispositivo</li>
            <li><strong>Token FCM</strong>: Per invio notifiche push (con tuo consenso)</li>
            <li><strong>Logs di accesso</strong>: Per troubleshooting e sicurezza</li>
        </ul>

        <h2>3. Base Giuridica del Trattamento (GDPR)</h2>
        <p>Trattiamo i tuoi dati sulla base delle seguenti basi giuridiche:</p>
        <ol>
            <li><strong>Esecuzione del contratto</strong> (Art. 6.1.b GDPR): Per fornire il servizio di prenotazione</li>
            <li><strong>Consenso esplicito</strong> (Art. 6.1.a GDPR): Per notifiche push, marketing, geolocalizzazione</li>
            <li><strong>Obbligo legale</strong> (Art. 6.1.c GDPR): Per conservazione dati fiscali</li>
            <li><strong>Legittimo interesse</strong> (Art. 6.1.f GDPR): Per prevenzione frodi e sicurezza</li>
        </ol>

        <h2>4. Finalit√† del Trattamento</h2>
        <p>I tuoi dati vengono utilizzati per:</p>
        <ul>
            <li>‚úÖ Gestire registrazione e autenticazione utenti</li>
            <li>‚úÖ Elaborare prenotazioni e pagamenti</li>
            <li>‚úÖ Inviare conferme, promemoria e notifiche prenotazioni</li>
            <li>‚úÖ Fornire assistenza clienti</li>
            <li>‚úÖ Migliorare il servizio tramite analytics anonime</li>
            <li>‚úÖ Prevenire frodi e abusi</li>
            <li>‚úÖ Rispettare obblighi legali (fatturazione, contabilit√†)</li>
        </ul>

        <h2>5. Condivisione Dati con Terze Parti</h2>
        <p>Condividiamo i tuoi dati SOLO con i seguenti fornitori di servizi essenziali:</p>

        <h3>5.1 Responsabili del Trattamento (Art. 28 GDPR)</h3>
        <ul>
            <li><strong>Google Firebase</strong>: Autenticazione, database, storage, hosting
                <br><small>‚Üí <a href="https://firebase.google.com/support/privacy" target="_blank">Privacy Policy Firebase</a></small>
                <br><small>‚Üí <a href="https://privacy.google.com/businesses/processorterms/" target="_blank">DPA Google Cloud</a></small>
            </li>
            <li><strong>Stripe Inc.</strong>: Elaborazione pagamenti con carta di credito
                <br><small>‚Üí <a href="https://stripe.com/privacy" target="_blank">Privacy Policy Stripe</a></small>
                <br><small>‚Üí <a href="https://stripe.com/legal/dpa" target="_blank">DPA Stripe</a></small>
            </li>
            <li><strong>PayPal Holdings Inc.</strong>: Elaborazione pagamenti PayPal
                <br><small>‚Üí <a href="https://www.paypal.com/privacy" target="_blank">Privacy Policy PayPal</a></small>
                <br><small>‚Üí <a href="https://www.paypal.com/webapps/mpp/ua/serviceuserexperience-full" target="_blank">User Agreement PayPal</a></small>
            </li>
        </ul>

        <div class="highlight">
            <strong>üìå Nota:</strong> Tutti i responsabili del trattamento sono vincolati da Data Processing Agreements (DPA) conformi al GDPR e adottano misure di sicurezza adeguate.
        </div>

        <h2>6. Trasferimenti Internazionali di Dati</h2>
        <p>Alcuni fornitori di servizi possono trasferire dati al di fuori dell'Area Economica Europea (SEE):</p>
        <ul>
            <li><strong>Google Firebase (USA)</strong>: Trasferimento basato su <strong>Standard Contractual Clauses (SCC)</strong> approvate dalla Commissione UE</li>
            <li><strong>Stripe (USA)</strong>: Trasferimento basato su <strong>Standard Contractual Clauses (SCC)</strong></li>
            <li><strong>PayPal (USA)</strong>: Trasferimento basato su <strong>Standard Contractual Clauses (SCC)</strong></li>
        </ul>
        <p>Tutti i trasferimenti sono conformi al Capitolo V del GDPR.</p>

        <h2>7. Conservazione dei Dati</h2>
        <p>Conserviamo i tuoi dati per i seguenti periodi:</p>
        <ul>
            <li><strong>Account attivi</strong>: Fino alla richiesta di cancellazione</li>
            <li><strong>Account cancellati</strong>: 30 giorni (backup), poi eliminazione definitiva</li>
            <li><strong>Dati fiscali</strong>: 10 anni (obbligo di legge italiano)</li>
            <li><strong>Logs di sicurezza</strong>: 12 mesi</li>
            <li><strong>Dati di pagamento tokenizzati</strong>: Fino alla scadenza abbonamento + 6 mesi</li>
        </ul>

        <h2>8. I Tuoi Diritti (GDPR Artt. 15-22)</h2>
        <p>Hai i seguenti diritti sui tuoi dati personali:</p>

        <h3>‚úÖ Diritto di Accesso (Art. 15)</h3>
        <p>Puoi richiedere copia di tutti i dati che abbiamo su di te.</p>

        <h3>‚úÖ Diritto di Rettifica (Art. 16)</h3>
        <p>Puoi correggere dati inesatti o incompleti direttamente dall'app.</p>

        <h3>‚úÖ Diritto alla Cancellazione (Art. 17)</h3>
        <p>Puoi richiedere la cancellazione del tuo account e di tutti i dati associati.</p>

        <h3>‚úÖ Diritto di Limitazione del Trattamento (Art. 18)</h3>
        <p>Puoi limitare temporaneamente il trattamento dei tuoi dati.</p>

        <h3>‚úÖ Diritto alla Portabilit√† (Art. 20)</h3>
        <p>Puoi ricevere i tuoi dati in formato strutturato e leggibile da machine (JSON).</p>

        <h3>‚úÖ Diritto di Opposizione (Art. 21)</h3>
        <p>Puoi opporti al trattamento basato su legittimo interesse.</p>

        <h3>‚úÖ Diritto di Revoca del Consenso (Art. 7.3)</h3>
        <p>Puoi revocare il consenso per notifiche push, marketing, geolocalizzazione in qualsiasi momento.</p>

        <div class="highlight">
            <strong>üìß Come Esercitare i Tuoi Diritti:</strong><br>
            Invia una richiesta a: <a href="mailto:support@mypetcareapp.org">support@mypetcareapp.org</a><br>
            Risponderemo entro <strong>30 giorni</strong> (Art. 12.3 GDPR)
        </div>

        <h2>9. Misure di Sicurezza</h2>
        <p>Adottiamo misure tecniche e organizzative avanzate per proteggere i tuoi dati:</p>
        <ul>
            <li>üîê <strong>Crittografia TLS/SSL</strong>: Tutte le comunicazioni sono cifrate</li>
            <li>üîê <strong>Password crittografate</strong>: Utilizziamo algoritmo bcrypt con salt</li>
            <li>üîê <strong>Firebase Security Rules</strong>: Accesso ai dati basato su regole rigorose</li>
            <li>üîê <strong>Autenticazione a due fattori</strong> (2FA): Opzionale per account PRO</li>
            <li>üîê <strong>Tokenizzazione pagamenti</strong>: Nessun dato carta memorizzato</li>
            <li>üîê <strong>Rate limiting</strong>: Protezione contro attacchi brute-force</li>
            <li>üîê <strong>Logs audit</strong>: Tracciamento accessi per sicurezza</li>
            <li>üîê <strong>Backup cifrati</strong>: Backup automatici giornalieri crittografati</li>
        </ul>

        <h2>10. Cookie e Tecnologie di Tracciamento</h2>
        <p>L'app utilizza le seguenti tecnologie:</p>
        <ul>
            <li><strong>Token di sessione</strong>: Per mantenere l'autenticazione (necessari)</li>
            <li><strong>Firebase Analytics</strong>: Per statistiche anonime di utilizzo (con consenso)</li>
            <li><strong>Crashlytics</strong>: Per rilevare bug e crash (anonimizzato)</li>
        </ul>
        <p>Puoi disabilitare analytics dalle impostazioni dell'app.</p>

        <h2>11. Privacy dei Minori</h2>
        <p>MyPetCare NON √® destinato a minori di 16 anni. Non raccogliamo intenzionalmente dati di minori. Se scopriamo di aver raccolto dati di un minore, li elimineremo immediatamente.</p>

        <h2>12. Modifiche alla Privacy Policy</h2>
        <p>Ci riserviamo il diritto di aggiornare questa Privacy Policy. Le modifiche sostanziali saranno notificate tramite:</p>
        <ul>
            <li>üìß Email agli utenti registrati</li>
            <li>üì± Notifica push nell'app</li>
            <li>üåê Banner sul sito web</li>
        </ul>
        <p>L'uso continuato dell'app dopo le modifiche costituisce accettazione della nuova policy.</p>

        <h2>13. Autorit√† di Controllo</h2>
        <p>Hai il diritto di presentare reclamo all'autorit√† di controllo competente:</p>
        <div class="contact">
            <strong>üáÆüáπ Garante per la Protezione dei Dati Personali</strong><br>
            Piazza Venezia, 11 - 00187 Roma<br>
            Tel: +39 06 696771<br>
            Email: <a href="mailto:garante@gpdp.it">garante@gpdp.it</a><br>
            Sito: <a href="https://www.garanteprivacy.it" target="_blank">www.garanteprivacy.it</a>
        </div>

        <div class="contact">
            <h2>14. Contatti</h2>
            <p>Per qualsiasi domanda sulla Privacy Policy o sui tuoi diritti GDPR:</p>
            <p>
                <strong>Email:</strong> <a href="mailto:support@mypetcareapp.org">support@mypetcareapp.org</a><br>
                <strong>Oggetto:</strong> "Privacy - [Tua Richiesta]"
            </p>
            <p>Risponderemo entro <strong>30 giorni</strong> dalla ricezione della richiesta.</p>
        </div>

        <footer>
            <p>&copy; 2025 MyPetCare. Tutti i diritti riservati.</p>
            <p>
                <a href="https://mypetcareapp.org">Home</a> | 
                <a href="https://mypetcareapp.org/terms">Termini di Servizio</a> | 
                <a href="https://mypetcareapp.org/support">Supporto</a>
            </p>
            <p class="last-updated">Versione: 1.0 - Ultimo aggiornamento: 12 Novembre 2025</p>
        </footer>
    </div>
<!-- Google Consent Mode v2 -->
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  
  // Default consent state (denied)
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied',
    'analytics_storage': 'denied',
    'functionality_storage': 'denied',
    'personalization_storage': 'denied',
    'security_storage': 'granted',  // Always granted for security
    'wait_for_update': 500
  });
  
  // Load saved consent from localStorage
  (function() {
    var consent = localStorage.getItem('cookie_consent');
    if (consent) {
      var consentData = JSON.parse(consent);
      gtag('consent', 'update', consentData);
    }
  })();
</script>

<!-- Google Analytics 4 (replace G-XXXXXXX with your Measurement ID) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXX', {
    'anonymize_ip': true,
    'cookie_flags': 'SameSite=None;Secure'
  });
</script>

<!-- Cookie Consent Banner Styles -->
<style>
  #cookie-consent-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #1C8275;
    color: white;
    padding: 20px;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
    z-index: 10000;
    display: none;
    animation: slideUp 0.3s ease-out;
  }
  
  @keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
  }
  
  #cookie-consent-banner.show {
    display: block;
  }
  
  .cookie-consent-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
  }
  
  .cookie-consent-text {
    flex: 1;
    min-width: 300px;
  }
  
  .cookie-consent-text h3 {
    margin-bottom: 10px;
    font-size: 1.2rem;
  }
  
  .cookie-consent-text p {
    margin-bottom: 10px;
    opacity: 0.9;
  }
  
  .cookie-consent-text a {
    color: #FFF;
    text-decoration: underline;
  }
  
  .cookie-consent-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .cookie-consent-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 5px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .cookie-consent-btn-accept {
    background: white;
    color: #1C8275;
  }
  
  .cookie-consent-btn-accept:hover {
    background: #f0f0f0;
    transform: scale(1.05);
  }
  
  .cookie-consent-btn-reject {
    background: transparent;
    color: white;
    border: 2px solid white;
  }
  
  .cookie-consent-btn-reject:hover {
    background: rgba(255,255,255,0.1);
  }
  
  .cookie-consent-btn-customize {
    background: rgba(255,255,255,0.2);
    color: white;
  }
  
  .cookie-consent-btn-customize:hover {
    background: rgba(255,255,255,0.3);
  }
  
  /* Cookie Settings Modal */
  #cookie-settings-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 10001;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  
  #cookie-settings-modal.show {
    display: flex;
  }
  
  .cookie-settings-content {
    background: white;
    color: #333;
    padding: 30px;
    border-radius: 10px;
    max-width: 600px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
  }
  
  .cookie-settings-content h3 {
    margin-bottom: 20px;
    color: #1C8275;
  }
  
  .cookie-category {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
  }
  
  .cookie-category:last-child {
    border-bottom: none;
  }
  
  .cookie-toggle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .cookie-toggle label {
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .cookie-toggle input[type="checkbox"] {
    width: 50px;
    height: 26px;
    position: relative;
    appearance: none;
    background: #ccc;
    border-radius: 13px;
    cursor: pointer;
    transition: background 0.3s;
  }
  
  .cookie-toggle input[type="checkbox"]:checked {
    background: #1C8275;
  }
  
  .cookie-toggle input[type="checkbox"]::before {
    content: '';
    position: absolute;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: white;
    top: 2px;
    left: 2px;
    transition: left 0.3s;
  }
  
  .cookie-toggle input[type="checkbox"]:checked::before {
    left: 26px;
  }
  
  .cookie-toggle input[type="checkbox"]:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .cookie-description {
    font-size: 14px;
    color: #666;
    margin-top: 5px;
  }
  
  .cookie-settings-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
  }
  
  .cookie-settings-buttons button {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 5px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .cookie-settings-buttons .btn-save {
    background: #1C8275;
    color: white;
  }
  
  .cookie-settings-buttons .btn-save:hover {
    background: #145B52;
  }
  
  .cookie-settings-buttons .btn-cancel {
    background: #eee;
    color: #333;
  }
  
  .cookie-settings-buttons .btn-cancel:hover {
    background: #ddd;
  }
  
  @media (max-width: 768px) {
    .cookie-consent-content {
      flex-direction: column;
      text-align: center;
    }
    
    .cookie-consent-buttons {
      width: 100%;
      justify-content: center;
    }
    
    .cookie-consent-btn {
      flex: 1;
      min-width: 100px;
    }
  }
</style>

<!-- Cookie Consent Banner HTML -->
<div id="cookie-consent-banner">
  <div class="cookie-consent-content">
    <div class="cookie-consent-text">
      <h3>üç™ Utilizziamo i Cookie</h3>
      <p>
        Utilizziamo cookie e tecnologie simili per migliorare la tua esperienza sul nostro sito.
        Consulta la nostra <a href="/privacy.html">Privacy Policy</a> per maggiori informazioni.
      </p>
    </div>
    <div class="cookie-consent-buttons">
      <button class="cookie-consent-btn cookie-consent-btn-accept" onclick="acceptAllCookies()">
        Accetta Tutti
      </button>
      <button class="cookie-consent-btn cookie-consent-btn-reject" onclick="rejectAllCookies()">
        Rifiuta Tutti
      </button>
      <button class="cookie-consent-btn cookie-consent-btn-customize" onclick="showCookieSettings()">
        Personalizza
      </button>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div id="cookie-settings-modal">
  <div class="cookie-settings-content">
    <h3>‚öôÔ∏è Impostazioni Cookie</h3>
    <p style="margin-bottom: 20px;">Scegli quali cookie desideri accettare. I cookie necessari sono sempre attivi.</p>
    
    <div class="cookie-category">
      <div class="cookie-toggle">
        <label>
          <input type="checkbox" id="consent-necessary" checked disabled>
          Cookie Necessari
        </label>
      </div>
      <div class="cookie-description">
        Questi cookie sono essenziali per il funzionamento del sito e non possono essere disabilitati.
      </div>
    </div>
    
    <div class="cookie-category">
      <div class="cookie-toggle">
        <label>
          <input type="checkbox" id="consent-analytics">
          Cookie Analitici
        </label>
      </div>
      <div class="cookie-description">
        Ci aiutano a capire come i visitatori utilizzano il sito, raccogliendo informazioni in forma anonima.
      </div>
    </div>
    
    <div class="cookie-category">
      <div class="cookie-toggle">
        <label>
          <input type="checkbox" id="consent-functional">
          Cookie Funzionali
        </label>
      </div>
      <div class="cookie-description">
        Permettono di ricordare le tue preferenze e migliorare la tua esperienza personalizzata.
      </div>
    </div>
    
    <div class="cookie-category">
      <div class="cookie-toggle">
        <label>
          <input type="checkbox" id="consent-marketing">
          Cookie di Marketing
        </label>
      </div>
      <div class="cookie-description">
        Utilizzati per mostrare contenuti pubblicitari pi√π rilevanti per te e i tuoi interessi.
      </div>
    </div>
    
    <div class="cookie-settings-buttons">
      <button class="btn-save" onclick="saveCustomCookieSettings()">Salva Preferenze</button>
      <button class="btn-cancel" onclick="closeCookieSettings()">Annulla</button>
    </div>
  </div>
</div>

<!-- Cookie Consent JavaScript -->
<script>
  // Check if user has already made a choice
  (function() {
    var consent = localStorage.getItem('cookie_consent');
    if (!consent) {
      // Show banner after 1 second
      setTimeout(function() {
        document.getElementById('cookie-consent-banner').classList.add('show');
      }, 1000);
    }
  })();
  
  function acceptAllCookies() {
    var consentData = {
      'ad_storage': 'granted',
      'ad_user_data': 'granted',
      'ad_personalization': 'granted',
      'analytics_storage': 'granted',
      'functionality_storage': 'granted',
      'personalization_storage': 'granted'
    };
    
    gtag('consent', 'update', consentData);
    localStorage.setItem('cookie_consent', JSON.stringify(consentData));
    localStorage.setItem('cookie_consent_date', new Date().toISOString());
    
    hideCookieBanner();
  }
  
  function rejectAllCookies() {
    var consentData = {
      'ad_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'analytics_storage': 'denied',
      'functionality_storage': 'denied',
      'personalization_storage': 'denied'
    };
    
    gtag('consent', 'update', consentData);
    localStorage.setItem('cookie_consent', JSON.stringify(consentData));
    localStorage.setItem('cookie_consent_date', new Date().toISOString());
    
    hideCookieBanner();
  }
  
  function showCookieSettings() {
    // Load current settings
    var consent = localStorage.getItem('cookie_consent');
    if (consent) {
      var consentData = JSON.parse(consent);
      document.getElementById('consent-analytics').checked = consentData.analytics_storage === 'granted';
      document.getElementById('consent-functional').checked = consentData.functionality_storage === 'granted';
      document.getElementById('consent-marketing').checked = consentData.ad_storage === 'granted';
    }
    
    document.getElementById('cookie-settings-modal').classList.add('show');
  }
  
  function closeCookieSettings() {
    document.getElementById('cookie-settings-modal').classList.remove('show');
  }
  
  function saveCustomCookieSettings() {
    var analytics = document.getElementById('consent-analytics').checked;
    var functional = document.getElementById('consent-functional').checked;
    var marketing = document.getElementById('consent-marketing').checked;
    
    var consentData = {
      'ad_storage': marketing ? 'granted' : 'denied',
      'ad_user_data': marketing ? 'granted' : 'denied',
      'ad_personalization': marketing ? 'granted' : 'denied',
      'analytics_storage': analytics ? 'granted' : 'denied',
      'functionality_storage': functional ? 'granted' : 'denied',
      'personalization_storage': functional ? 'granted' : 'denied'
    };
    
    gtag('consent', 'update', consentData);
    localStorage.setItem('cookie_consent', JSON.stringify(consentData));
    localStorage.setItem('cookie_consent_date', new Date().toISOString());
    
    closeCookieSettings();
    hideCookieBanner();
  }
  
  function hideCookieBanner() {
    document.getElementById('cookie-consent-banner').classList.remove('show');
  }
  
  // Global function to revoke consent (can be called from Privacy Policy page)
  window.revokeCookieConsent = function() {
    localStorage.removeItem('cookie_consent');
    localStorage.removeItem('cookie_consent_date');
    location.reload();
  };
</script>


  <!-- Service Worker Registration -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function() {
        navigator.serviceWorker.register("/service-worker.js")
          .then(function(registration) {
            console.log("‚úÖ Service Worker registered:", registration.scope);
            
            // Check for updates
            registration.addEventListener("updatefound", function() {
              const newWorker = registration.installing;
              newWorker.addEventListener("statechange", function() {
                if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
                  console.log("üîÑ New Service Worker available. Refresh to update.");
                  // Optional: Show update notification to user
                }
              });
            });
          })
          .catch(function(error) {
            console.log("‚ùå Service Worker registration failed:", error);
          });
      });
      
      // Handle Service Worker updates
      let refreshing = false;
      navigator.serviceWorker.addEventListener("controllerchange", function() {
        if (!refreshing) {
          refreshing = true;
          window.location.reload();
        }
      });
    }
  </script>

</body>
</html>
